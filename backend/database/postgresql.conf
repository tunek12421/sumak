# PostgreSQL Configuration - Security Hardened
# =============================================

# CONNECTIONS AND AUTHENTICATION
# -------------------------------
listen_addresses = '*'  # Listen on all interfaces (safe because container network)
max_connections = 100
password_encryption = scram-sha-256

# SECURITY AND AUTHENTICATION
# ---------------------------
ssl = off  # Disabled in container, TLS handled by nginx

# LOGGING
# -------
# Enable comprehensive logging for security auditing
logging_collector = on
log_destination = 'stderr'
log_connections = on
log_disconnections = on
log_duration = off
log_line_prefix = '%t [%p]: user=%u,db=%d,app=%a,client=%h '
log_statement = 'ddl'  # Log DDL statements (CREATE, ALTER, DROP, etc.)
log_min_duration_statement = 1000  # Log queries taking more than 1 second

# Log errors and warnings
log_min_messages = warning
log_min_error_statement = error

# RESOURCE USAGE
# --------------
shared_buffers = 128MB
work_mem = 4MB
maintenance_work_mem = 64MB
effective_cache_size = 256MB

# QUERY TUNING
# ------------
random_page_cost = 1.1  # SSD optimization

# SECURITY RECOMMENDATIONS
# ------------------------
# These settings help prevent common attacks:
# 1. log_connections/log_disconnections: Track who connects
# 2. log_statement='ddl': Log dangerous operations like DROP, ALTER
# 3. log_line_prefix: Include user, database, and client IP in logs

# For production, consider also:
# - Restricting pg_hba.conf to specific IPs
# - Using SSL certificates
# - Disabling COPY TO PROGRAM if not needed:
#   (Requires PostgreSQL 16+)
#   # ALTER SYSTEM SET allow_system_table_mods = off;
